üìò ENTREGA FINAL DEFINITIVA ‚Äì MEDINTELLI BASIC IA

Vers√£o: 1.0 (Entrega Final de Produ√ß√£o)
Ambientes:

Sistema Principal ‚Üí https://62zkzdeuuhvj.space.minimax.io

App Paciente ‚Üí https://m5etmn33she8.space.minimax.io
Banco: Supabase
Mensageria: Avisa API (WhatsApp)
IA: OpenAI (base local unificada)

üéØ OBJETIVO FINAL

Entregar o sistema completo, 100% funcional, sem erros, conforme a documenta√ß√£o original e o checklist de valida√ß√£o (31 itens), garantindo integra√ß√£o plena entre:

Sistema Principal

App Paciente

WhatsApp (via Avisa API)

IA (com base de conhecimento unificada)

‚öôÔ∏è ESTRUTURA GERAL DO PROJETO
M√≥dulo	Fun√ß√£o principal	Local
Sistema Principal	Controle administrativo, agenda, pacientes, fila, feriados, mensagens	/
App Paciente	Agendamento, hist√≥rico, chat IA, envio de exames	/app
Edge Functions	L√≥gica back-end (Supabase Functions)	supabase/functions/
API Routes	Intermedia√ß√£o segura (Next.js)	/pages/api/
knowledge	Base de conhecimento da IA	/knowledge/base_conhecimento.txt
üß© M√ìDULOS E FUNCIONALIDADES (definitivas)
1Ô∏è‚É£ LOGIN e AUTENTICA√á√ÉO

Utilizar Supabase Auth com persist√™ncia local (persistSession: true).

Garantir que o login redirecione corretamente ap√≥s SIGNED_IN.

Corrigir looping infinito (usar sessionChecked e router.replace('/dashboard')).

Permitir perfis: SuperAdmin, Admin, Auxiliar, Secretaria, Medico.

2Ô∏è‚É£ USU√ÅRIOS

CRUD completo (listar, criar, editar, inativar).

Permitir altera√ß√£o de senha e perfil.

Mensagem de sucesso/erro amig√°vel.

3Ô∏è‚É£ PACIENTES

CRUD completo com busca (nome, telefone, convenio).

Cadastro r√°pido dentro de Agenda e Fila de Espera sem sair da tela.

Campo Conv√™nio deve listar: UNIMED, UNIMED UNIF√ÅCIL, CASSI, CABESP, PARTICULAR.

Valida√ß√£o obrigat√≥ria: Nome e Telefone.

Exibir status (Ativo/Inativo).

4Ô∏è‚É£ AGENDA

Visualiza√ß√£o: Dia / Semana / M√™s.

Fun√ß√µes:

Criar, Editar, Cancelar.

Reagendar com drag-and-drop.

Mostrar pacientes e n√£o pacientes.

Detectar conflitos e exibir mensagem.

Feriados aparecem bloqueados.

Ocultar hor√°rios ocupados no App Paciente.

Sincronizar automaticamente ap√≥s qualquer modifica√ß√£o.

Permitir registro de observa√ß√µes e tipo de consulta (primeira, retorno, telemedicina etc.).

5Ô∏è‚É£ FILA DE ESPERA

Listar todos os pacientes na fila.

Permitir reordena√ß√£o (drag-and-drop).

Cadastro r√°pido (paciente novo ou existente).

A√ß√µes:

Adicionar / Remover / Chamar / Converter em agendamento.

Sugest√£o autom√°tica de 3 hor√°rios livres.

Exibir status de atendimento.

6Ô∏è‚É£ FERIADOS

Sincronizar nacionais (via OpenAI API).

Criar / Editar / Excluir municipais.

Campo ‚ÄúRecorrente para todos os anos‚Äù.

Exibir bloqueio na agenda e no App Paciente.

Corrigir erros ‚Äúconstano‚Äù e ‚ÄúPOST indefinida‚Äù.

Fun√ß√£o feriados-sync implementada conforme hotfix v15.

7Ô∏è‚É£ MENSAGENS (PAINEL CENTRAL)

Duas abas: App Paciente e WhatsApp.

Exibir contador de mensagens n√£o lidas.

Exibir nome do paciente (vinculado ao cadastro).

Bot√£o Encaminhar ‚Üí Dr. Francisco dispon√≠vel nas duas abas.

Ao encerrar conversa ‚Üí mover para hist√≥rico.

Atualiza√ß√£o autom√°tica a cada 10 segundos.

Permitir filtrar mensagens por status (lida/n√£o lida/encaminhada).

8Ô∏è‚É£ APP PACIENTE

Login simples com e-mail e senha.

Funcionalidades:

Agendamento (somente hor√°rios livres).

Hist√≥rico (consultas passadas e futuras).

Chat com IA (responde at√© concluir atendimento).

Envio de Exames (gera registro no painel principal).

Corrigir bug de fuso (usar America/Sao_Paulo).

Corrigir looping no hist√≥rico (usar timeout e abort controller).

Mensagens vazias ‚Üí exibir ‚ÄúNenhum item encontrado‚Äù.

9Ô∏è‚É£ IA (AGENTE MEDINTELLI)

Base unificada (knowledge/base_conhecimento.txt).

Deve compreender inten√ß√µes:

Agendar, Cancelar, Reagendar, Enviar Exame, D√∫vidas Gerais.

Utilizar gpt-4o-mini com temperature: 0.2.

Fun√ß√£o agent-ia deve:

Ler a base local no path configurado.

Gravar o contexto em ia_contextos.

Retornar a√ß√£o sugerida (para agendamento, cancelamento ou exame).

üîü INTEGRA√á√ÉO WHATSAPP (AVISA API)
Configura√ß√£o:

AVISA_API_URL e AVISA_API_KEY definidos no .env.

Webhook Receiver:

https://2m72mamv4exw.space.minimax.io/api/whatsapp-webhook


Mensagens de teste autorizadas somente para:
+55 16 98870-7777

Edge Functions:

whatsapp-send-message

whatsapp-webhook-receiver

Envio e recebimento registrados na tabela whatsapp_messages.

Fluxo:

Paciente envia mensagem ‚Üí webhook grava e dispara agent-ia.

Agente responde via whatsapp-send-message.

Mensagem aparece no painel de mensagens do Sistema Principal.

Encaminhamento ao Dr. Francisco dispon√≠vel.

üß† VARI√ÅVEIS .ENV (obrigat√≥rias)
SUPABASE_URL=
SUPABASE_ANON_KEY=
SUPABASE_SERVICE_ROLE_KEY=
OPENAI_API_KEY=
OPENAI_MODEL=gpt-4o-mini
AVISA_API_URL=
AVISA_API_KEY=
WHATSAPP_WEBHOOK_SECRET=
BASE_KNOWLEDGE_PATH=./knowledge/base_conhecimento.txt
TZ=America/Sao_Paulo

üßæ VALIDA√á√ÉO FINAL (Checklist 31 Itens)

Reaplicar integralmente o Manual de Entrega ‚Äì MedIntelli Basic IA:

Etapa 1 ‚Üí 23 funcionalidades (Usu√°rios, Pacientes, Feriados, Agenda, Fila).

Etapa 2 ‚Üí 12 funcionalidades (WhatsApp, App Paciente, IA).

Todos os testes devem ser executados com os usu√°rios abaixo:

Nome	E-mail	Senha	Perfil
Alencar	alencar@medintelli.com.br
	senha123	ADMIN
Silvia	silvia@medintelli.com.br
	senha123	ADMIN
Gabriel	gabriel@medintelli.com.br
	senha123	AUXILIAR
Natashia	natashia@medintelli.com.br
	senha123	SECRETARIA
Dr. Francisco	drfrancisco@medintelli.com.br
	senha123	MEDICO
üß™ TESTES AUTOMATIZADOS (Minimax)

Testar CRUD completo de pacientes e agenda.

Validar login simult√¢neo (usu√°rio + paciente).

Enviar mensagem pelo App Paciente ‚Üí deve aparecer no painel.

Enviar mensagem WhatsApp ‚Üí IA deve responder automaticamente.

Criar agendamento ‚Üí verificar registro no Supabase.

Cancelar consulta ‚Üí deve atualizar o status.

Enviar exame ‚Üí deve aparecer para equipe auxiliar.

Validar feriados ‚Üí bloqueio ativo no App Paciente.

Verificar timeout ‚Üí nenhuma tela deve travar em loop.

üß± CONFIGURA√á√ïES SUPABASE

Redirect URLs:

https://*.space.minimax.io
https://2m72mamv4exw.space.minimax.io
https://m5etmn33she8.space.minimax.io
http://localhost:3000


Site URL:
https://2m72mamv4exw.space.minimax.io

RLS:
Desativado em todas as tabelas principais.

Pol√≠ticas futuras:
Habilitar somente ap√≥s valida√ß√£o final.

üí° REQUISITOS DE UI/UX

Layout profissional (tons claros e m√©dicos).

Feedback visual em todas as a√ß√µes (toasts).

Indicador de carregamento com timeout 15s.

Mensagens de erro sempre leg√≠veis.

Responsividade para desktop e mobile.

Exibir logs ‚ÄúVerificando sess√£o salva‚Ä¶‚Äù apenas em modo debug.

üöÄ ENTREGA FINAL (esperada do Minimax)

Resultado esperado:

Login sem loop

CRUD completo e validado

Agenda funcional e sincronizada

Fila de espera operante

Feriados sincronizados

Painel de mensagens ativo (App e WhatsApp)

IA respondendo automaticamente e concluindo atendimento

App Paciente fluido e sem travamentos

Base de conhecimento carregando corretamente